<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/WD-html-in-xml/DTD/xhtml1-strict.dtd">
<html><head><title>Castor JDO - Advanced features</title><link rel="stylesheet" href="default.css"></head><body bgcolor="#ffffff" link="#6763a9" vlink="#6763a9" topmargin="0" bottommargin="0" leftmargin="0" marginheight="0" marginwidth="0"><a name="top"></a><table border="0" cellpadding="0" cellspacing="0" height="400"><tr><td width="10" valign="top" align="left" bgcolor="#7270c2"><img src="images/dotTrans.gif" width="1" height="1" border="0"></td><td width="125" valign="top" align="left" bgcolor="#7270c2"><img src="images/dotTrans.gif" width="1" height="1" border="0"></td><td width="7" valign="top" align="left"><img src="images/dotTrans.gif" border="0" width="1" height="1"></td><td width="70" valign="top" align="left"><img src="images/dotTrans.gif" width="70" height="6" border="0"></td><td width="468" valign="top" align="left"><img src="images/top_2.gif" width="468" height="6" border="0"></td><td width="120" valign="top" align="left"><img src="images/line_purple.gif" width="120" height="6" border="0"></td></tr><tr><td width="10" bgcolor="#7270c2" valign="top" align="left"><img src="images/dotTrans.gif" border="0" width="1" height="1"></td><td width="125" bgcolor="#7270c2" valign="top" align="left"><img src="images/dotTrans.gif" border="0" width="1" height="1"></td><td width="7" bgcolor="#ffffff" valign="top" align="left"></td><td width="70" valign="top" align="left"><img src="images/dotTrans.gif" width="1" height="1" border="0"></td><td width="468" valign="middle" align="left"><a href="http://www.codehaus.org"><span class="menuTopOff">Codehaus</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.exolab.org"><span class="menuTopOff">ExoLab</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://openejb.codehaus.org"><span class="menuTopOff">OpenEJB</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://openjms.sf.net"><span class="menuTopOff">OpenJMS</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://openorb.sf.net"><span class="menuTopOn">OpenORB</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://castor.codehaus.org"><span class="menuTopOff">Castor</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://tyrex.sf.net"><span class="menuTopOff">Tyrex</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="images/dotTrans.gif" width="1" height="2" border="0"></td><td width="120" height="20" valign="top" align="left">&nbsp;</td></tr><tr><td width="10" bgcolor="#7270c2" valign="top" align="left"><img src="images/dotTrans.gif" width="10" height="3" border="0"></td><td width="125" bgcolor="#7270c2" valign="top" align="right"><img src="images/line_sm.gif" width="105" height="3" border="0"></td><td width="7" bgcolor="#a9a5de" valign="top" align="left"><img src="images/line_sm.gif" width="7" height="3" border="0"></td><td width="70" valign="top" align="left"><img src="images/line_light.gif" width="70" height="3" border="0"></td><td width="468" valign="top" align="left"><img src="images/line_light.gif" width="468" height="3" border="0"></td><td width="120" valign="top" align="left"><img src="images/dotTrans.gif" border="0" width="1" height="1"></td></tr><tr><td bgcolor="#7270c2" valign="top" align="left"><img src="images/dotTrans.gif" width="10" height="10" border="0"></td><td width="125" bgcolor="#7270c2" valign="top" align="left"><img src="images/dotTrans.gif" width="1" height="2" border="0"><br><table border="0" cellpadding="0" cellspacing="0"><tr><td valign="top" align="left"><span class="subMenuOn">Main</span></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="index.html"><span class="subMenuOff">Home</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="about.html"><span class="subMenuOff">About</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="features.html"><span class="subMenuOff">Features</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="download.html"><span class="subMenuOff">Download</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="api/overview-summary.html"><span class="subMenuOff">API</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="schema.html"><span class="subMenuOff">Schema</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="http://castor.exolab.org/phpBB2"><span class="subMenuOff">Castor Forums</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="lists.html"><span class="subMenuOff">Mailing Lists</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="cvs.html"><span class="subMenuOff">CVS / JIRA</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="support.html"><span class="subMenuOff">Support</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="http://www.brainopolis.com/castorwiki/Wiki.jsp?page=Main"><span class="subMenuOff">CastorWiki</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="http://castor.codehaus.org/rss/castor-announce.xml"><span class="subMenuOff">RSS news feed</span></a></td></tr></table><br><table border="0" cellpadding="0" cellspacing="0"><tr><td valign="top" align="left"><span class="subMenuOn">XML</span></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="xml-framework.html"><span class="subMenuOff">Using XML</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="sourcegen.html"><span class="subMenuOff">Source Generator</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="xmlschema.html"><span class="subMenuOff">Schema Support</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="xml-mapping.html"><span class="subMenuOff">XML Mapping</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="xml-faq.html"><span class="subMenuOff">XML FAQ</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="xml-fieldhandlers.html"><span class="subMenuOff">Custom Handlers</span></a></td></tr></table><br><table border="0" cellpadding="0" cellspacing="0"><tr><td valign="top" align="left"><span class="subMenuOn">JDO</span></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-introduction.html"><span class="subMenuOff">Introduction</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo.html"><span class="subMenuOff">Using JDO</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="database-conf.html"><span class="subMenuOff">JDO Config</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="types.html"><span class="subMenuOff">Types</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-mapping.html"><span class="subMenuOff">JDO Mapping</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-faq.html"><span class="subMenuOff">JDO FAQ</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-examples.html"><span class="subMenuOff">JDO Examples</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-howto.html"><span class="subMenuOff">JDO How-Tos</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-best-practice.html"><span class="subMenuOff">JDO Best Pract.</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-other-features.html"><span class="subMenuOff">Other Features</span></a></td></tr></table><br><table border="0" cellpadding="0" cellspacing="0"><tr><td valign="top" align="left"><span class="subMenuOn">Advanced JDO</span></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="oql.html"><span class="subMenuOff">OQL</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="locking.html"><span class="subMenuOff">Trans. &amp; Locks</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="design-persist.html"><span class="subMenuOff">Design</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="key-generator.html"><span class="subMenuOff">KeyGen</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="long-transact.html"><span class="subMenuOff">Long Trans.</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="nested-attr.html"><span class="subMenuOff">Nested Attrs.</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="pooling.html"><span class="subMenuOff">Pooling Examples</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="postgresql-blobs.html"><span class="subMenuOff">LOBs</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="jdo-best-practice.html"><span class="subMenuOff">Best practice</span></a></td></tr></table><br><table border="0" cellpadding="0" cellspacing="0"><tr><td valign="top" align="left"><span class="subMenuOn">More</span></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="presentations.html"><span class="subMenuOff">Presentations</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="examples.html"><span class="subMenuOff">The Examples</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="extras.html"><span class="subMenuOff">3rd Party Tools</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="test-framework.html"><span class="subMenuOff">JDO Tests</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="ctf.html"><span class="subMenuOff">XML Tests</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="conf-lib.html"><span class="subMenuOff">Configuration</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="tips-tricks.html"><span class="subMenuOff">Tips &amp; Tricks</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="javadoc/overview-summary.html"><span class="subMenuOff">Full JavaDoc</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="http://www.brainopolis.com/castorwiki/Wiki.jsp?page=Main"><span class="subMenuOff">CastorWiki</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href><span class="subMenuOff"></span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="http://www.java.net/"><span class="subMenuOff"><img src="images/javanet_button_90.gif" border="0"></span></a></td></tr></table><br><table border="0" cellpadding="0" cellspacing="0"><tr><td valign="top" align="left"><span class="subMenuOn">About</span></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="license.html"><span class="subMenuOff">License</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="contributors.html"><span class="subMenuOff">Contributors</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="marketplace.html"><span class="subMenuOff">Marketplace</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="status.html"><span class="subMenuOff">Status, Todo</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="release-notes.html"><span class="subMenuOff">Changelog</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="library.html"><span class="subMenuOff">Library</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="contacts.html"><span class="subMenuOff">Contact</span></a></td></tr><tr><td valign="top" align="left">&nbsp;&nbsp;<a href="origins.html"><span class="subMenuOff">Project Name</span></a></td></tr></table><br></td><td width="7" bgcolor="#a9a5de" valign="top" align="left">&nbsp;</td><td width="70" valign="top" align="left">&nbsp;</td><td rowspan="4" width="468" valign="top"><table cols="2" rows="2" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td valign="top" align="left"><br><img border="0" height="34" hspace="0" src="images/castor.gif" vspace="0" width="115"><br><img border="0" height="10" hspace="0" src="images/dotTrans.gif"></td><td width="120" height="5" valign="top" align="right"><a href="http://www.exolab.org"><img src="images/logo_exolab.gif" hspace="0" vspace="10" width="77" height="20" border="0"></a></td></tr></table><p></p><p></p><br><h2 align="center">Castor JDO - Advanced features</h2><p align="center">              Documentation Author(s):<br>Werner Guttmann<br></p><p><span class="bodyGrey">Reference: <a href="api/org/exolab/castor/jdo/package-summary.html"><api package="org.exolab.castor.jdo">The Java Data Objects API</api></a></span></p><HR size="1"><span class="bodyGrey"><b><a href="#Introduction">Introduction</a></b><br></span><span class="bodyGrey"><b><a href="#Caching">Caching</a></b><br></span><span class="bodyGrey"><a href="#Caching-and-clustered-environments">&nbsp;&nbsp;&nbsp;&nbsp;Caching and clustered environments</a><br></span><span class="bodyGrey"><a href="#Custom-cache-provider">&nbsp;&nbsp;&nbsp;&nbsp;Custom cache provider</a><br></span><span class="bodyGrey"><b><a href="#Dependent-and-related-relationships">Dependent and related relationships</a></b><br></span><span class="bodyGrey"><b><a href="#Different-cardinalities-of-relationship">Different cardinalities of relationship</a></b><br></span><span class="bodyGrey"><b><a href="#Lazy-Loading">Lazy Loading</a></b><br></span><span class="bodyGrey"><a href="#1:1-relations">&nbsp;&nbsp;&nbsp;&nbsp;1:1 relations</a><br></span><span class="bodyGrey"><a href="#1:M-and-M:N-relations">&nbsp;&nbsp;&nbsp;&nbsp;1:M and M:N relations</a><br></span><span class="bodyGrey"><b><a href="#Multiple-columns-primary-keys">Multiple columns primary keys</a></b><br></span><HR size="1"><br><a name="Introduction"><h2>Introduction</h2></a>                  <p><span class="bodyGrey">As explained at <a href="jdo-introduction.html">the introduction to Castor JDO</a>,            Castor has support for many advanced features such as caching, depend relations,             inheritance, polymorphism, etc. The below sections detail these features, as their            understanding is required to use Castor JDO in a performant and secure way.</span></p>     <a name="Caching"><h2>Caching</h2></a>              <p><span class="bodyGrey">Castor maintains and properly locks one copy of the dirty checking cache for each             object it loads from or creates into persistence storage. Until all transactions             involving the object are completed (See             <a href="design-persist.html#Persistence">Design: Persistence</a>), the cache is released.             Starting from Castor 0.8.6, performance cache is implemented and developer can specify the             mechanism and capacity of performance cache for each persistence capable type. Options includes             'none', 'count-limited', 'time-limited' and 'unlimited'. Starting from Castor 0.9.9, the cache             types 'coherence', 'jcs', 'jcache' and 'fkcache' have been added as explaind below. Performance             cache is write-through, because all changes to objects of a transaction should be persisted             at commit time without delay.</span></p>          <p><span class="bodyGrey">Performance caches enhance the application performance by reducing the number of read             operations against the persistence storage, by storing and reusing the last read or             committed values of the object. Performance caches do not affect the behavior of             short transactions or locking. It only affects persistence objects that have been released             from any transactional context. </span></p>          <p><span class="bodyGrey">With the current release, performance caches also serve a dual purpose as dirty checking             caches for <a href="long-transact.html">long-transactions</a>. This limitation implies that             the object's duration in the performance cache determines the allowed time span of a long             transaction. This might become an issue when performance caches of type 'count-limited' or             'time-limited' are being used, as objects will eventually be disposed. If an application             tries to update an object that has been disposed from the dirty checking cache,             an ObjectModifedException will be thrown.</span></p>          <p><span class="bodyGrey">The DTD declaration is as the following:             <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;!ATTLIST cache-type
    type ( none | count-limited
          | time-limited | unlimited | coherence | fkcache | jcache | jcs ) &quot;count-limited&quot;
    capacity NMTOKEN #IMPLIED&gt;</pre></span></td></tr></table></td></tr></table><p></p>         </span></p>          <p><span class="bodyGrey">For example,             <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class name=&quot;com.xyz.MyObject&quot;&gt;
        &lt;cache-type type=&quot;time-limited&quot; capacity=&quot;30&quot;/&gt;
        &lt;field name= ... &gt;
               ...
        &lt;/field&gt;
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span></td></tr></table></td></tr></table><p></p>              defines the time-limited least-recently-used algorithm as the caching algorithm for <i>com.xyz.MyObject</i> class and the cache will be disposed of if it is not used within 30 seconds. (Note that the time-limit ticks after all transaction involved with the objects complete, but not start after it is loaded.) </span></p>          <p><span class="bodyGrey"><b>NOTE:</b> The default cache-type is <tt>count-limited</tt> with a capacity of 100. This will             be used when no cache-type is specified in the mapping for a class.</span></p>                  <p><span class="bodyGrey"><b>NOTE:</b> As of release 0.9.6, Castor allows for the addition of user-defined cache             implementations. Instructions can be found <a href="jdo-caching.html">here</a></span></p>          <p><span class="bodyGrey"><b>NOTE:</b> As of release 0.9.9, four new cache types have been added to Castor, three             of them open source and one commercial:</span></p>                      <table border="0" cellspacing="1" cellpadding="2" bgcolor="#7270c2"><tr><td><table border="0" cellspacing="1" cellpadding="8" bgcolor="#ededed"><caption style="font-weight:bold"></caption><tr bgcolor="#7270c2"><cheader>                 <th>name</th>                 <th>Vendor</th>                 <th>Version</th>             </cheader></tr><tr bgcolor="#DDDDDD"><crow>                 <td>coherence</td>                 <td><url href="http://www.tangosol.com/coherence.jsp">Tangosol Coherence</url></td>                 <td>2.5</td>             </crow></tr><tr bgcolor="#FFFFFF"><crow>                 <td>jcs</td>                 <td><url href="http://jakarta.apache.org/jcs">JCS</url></td>                 <td>1.2.5</td>             </crow></tr><tr bgcolor="#DDDDDD"><crow>                 <td>fkcache</td>                 <td><url href="http://jcache.sourceforge.net/">FKCache</url></td>                 <td>1.0-beta6</td>             </crow></tr></table></td></tr></table>                  <p><span class="bodyGrey">As some of these cache providers allow for allow you to use it in a <b>distributed</b>             mode, this allows Castor JDO to be used in a clustered (multi-JVM) environment. Please see            the section below for short summayr fo this feature.</span></p>                  <p><span class="bodyGrey">For problems related to the use of performance caches, please consult with the relevant             entries in the <a href="jdo-faq.html#Castor and performance caches">JDO F.A.Q.</a>.</span></p>                  <a name="Caching-and-clustered-environments"><h3>Caching and clustered environments</h3></a>                  <p><span class="bodyGrey">All of the cache providers added with release 0.9.9 are distributed caches per se or can be              configured to operate in such a mode. This effectively allows Castor JDO to be used in a              clustered J2EE (multi-JVM) environment, where Castor JDO runs on each of the cluster instances,             and where cache state is automatically snychronized between these instances.</span></p>                          <p><span class="bodyGrey">In such an environment, Castor JDO wil make use of the underlying cache provider              to replicate/distribute the content of a specific cache between the various              JDOManager instances. Through the distribution mechanism of the cache provider, a client             of a Castor JDO instance on one JVM will see any updates made to domain objects performed              against any other JVM/JDO instance.</span></p>                  <p><span class="bodyGrey">The following class mapping, for example, ... </span></p>                              <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class name=&quot;com.xyz.MyOtherObject&quot;&gt;
        &lt;cache-type type=&quot;coherence&quot; /&gt;
        &lt;field name= ... &gt;
               ...
        &lt;/field&gt;
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span></td></tr></table></td></tr></table><p></p>                      <p><span class="bodyGrey">defines that for all objects of type <tt>com.xyz.MyOtherObject</tt> Tangosol's                  <i>Coherence</i> cache provider should be used.</span></p>                                    <a name="Custom-cache-provider"><h3>Custom cache provider</h3></a>                  <p><span class="bodyGrey">Castor provides a set of pre-built cache providers, offering a variety               of different cache algorithms. Nevertheless, special needs might               require the application developer to implement a custom cache                algorithm. Castor facilitates such need by making available standardized               interfaces and an easy to understand recipe for integrating a custom                cache provider with Castor.</span></p>                         <p><span class="bodyGrey">The main component of Castor's cache system is the interface                <a href="api/org/exolab/castor/persist/cache/Cache.html#Cache">Cache</a>,                which declares required functionality of a performance cache provider.                Existing (and future) cache implementations have to implement this                interface, which is closely modelled after <tt>java.util.Map</tt>.</span></p>                           <p><span class="bodyGrey">Below are defined the steps to build a custom cache provider and register               it with Castor JDO.</span></p>                 <p><span class="bodyGrey"><ol>                 <li>Create a class that implements                      <a href="api/org/exolab/castor/persist/cache/Cache.html#Cache">Cache</a>                    (we have provided an abstract base class that you can use at your                    convenience).                 <li>Create a class that implements                      <a href="api/org/exolab/castor/persist/cache/CacheFactory.html#CacheFactory">CacheFactory</a>                    (we have provided an abstract base class that you can use at your                    convenience).                 <li>Register your custom cache implementation with Castor JDO in the                     <tt>castor.properties</tt> file.             </ol></span></p>                  <p><span class="bodyGrey">Detailed instructions can be found in one of the                 <a href="jdo-howto.html">Castor JDO HOW-TO</a> documents.</span></p>                                    <a name="Dependent-and-related-relationships"><h2>Dependent and related relationships</h2></a>                  <p><span class="bodyGrey">Castor distinguishes the relationship of two objects as dependent or related, and             maintains the life cycle independently for the two types of relationships. Starting             from Castor 0.9, the developer can explicitly define a dependent relationship in             the mapping file.</span></p>          <p><span class="bodyGrey">When using independent relations, related objects&rsquo; life cycle is independent of each             other, meaning that they have to be created, removed and updated (for long             transaction) independently.</span></p>          <p><span class="bodyGrey">When using dependent relations, one data object class must be declared as             <b>depends</b> on one other data object class in the mapping file, and such an object             is called a dependent data object class. A data object class without             <i>depends</i> declared in the mapping is called a master object. A master object can             be depended upon by zero or more dependent data object class.</span></p>          <p><span class="bodyGrey">As of Castor 0.9, a dependent object class can be related to other master data             object classes including extended classes, but cannot depend on more than one             master class.</span></p>          <p><span class="bodyGrey">If an object class declared as <i>depends</i> on another class, it may not be             created, removed or updated separately. Attempting to create, remove or update a             dependent object will result in ObjectNotPersistcapableException. Note that Castor             doesn'&rsquo;t allow a dependent object instance to change its master object instance during             a transaction. Each dependent object can have only one master object. Both dependent and             master objects must have identities, and may or may not make use of key-generators.</span></p>          <p><span class="bodyGrey">             Here is the DTD for declaring dependent object:                           <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;!ATTLIST class     name ID  #REQUIRED
          extends   IDREF    #IMPLIED
          depends   IDREF    #IMPLIED
          identity  CDATA   #IMPLIED
          access    ( read-only | shared | exclusive | db-locked )  &quot;shared&quot;
          key-generator   IDREF #IMPLIED</pre></span></td></tr></table></td></tr></table><p></p></span></p>          <p><span class="bodyGrey">             For example,                              <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class name=&quot;com.xyz.MyDependentObject&quot;
        depends=&quot;com.xyz.MyObject&quot;&gt;
        ...
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span></td></tr></table></td></tr></table><p></p>                 declares the data object class <tt>com.xyz.MyDependentObject</tt> as a dependent                  upon class <tt>com.xyz.MyObject</tt>.</span></p>     <a name="Different-cardinalities-of-relationship"><h2>Different cardinalities of relationship</h2></a>                   <p><span class="bodyGrey">Castor supports different cardinalities of relationship, namely one-to-one,              one-to-many, and many-to-many. Many-to-many relationship must be related rather than              dependent, because each dependent object can have only one master object. </span></p>          <p><span class="bodyGrey">Many-to-many requires a separate table for storing the relations between two types of             objects. Many-to-many introduces two attributes, namely many-key and many-table that reside             in the <tt>&lt;sql&gt;</tt> element which is a sub-element of the <tt>&lt;field&gt;</tt>            element. For all many-to-many relations, a many-table must be specified. If the column             name of the primary key of the class is different from the foreign keys columns of the             class in the relation tables, then the relation table columns can be specified using the             many-key attributes. Similarly, if the column name of the primary key of the related class             is different from the foreign key columns of the related class, then the relation table             columns can be specified using the name attribute. </span></p>          <p><span class="bodyGrey">The many-table is used to store relations in a separate table                              <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class&gt;
        &lt;field&gt;
            &lt;sql many-key=&quot;#OPTIONAL&quot; name=&quot;#OPTIONAL&quot;
                 many-table=&quot;#REQURIED&quot;&gt;
        &lt;/field&gt;
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span></td></tr></table></td></tr></table><p></p>         </span></p>          <p><span class="bodyGrey">             So, for example, if the SQL table is the following,             <center>                 <b>employee_table</b></center>              <center><table border="true" cols="3" width="60%">                 <tr align="CENTER">                     <td><span class="bodyGrey"><b>id</b></span></td>   <td><span class="bodyGrey"><b>name</b></span></td>      <td><span class="bodyGrey"><b>salary</b></span></td>                 </tr>                  <tr>                     <td><span class="bodyGrey">1482</span></td>        <td><span class="bodyGrey">Smith, Bob</span></td>       <td><span class="bodyGrey">$123,456</span></td>                 </tr>                  <tr>                     <td><span class="bodyGrey">628</span></td>         <td><span class="bodyGrey">Lee, John</span></td>        <td><span class="bodyGrey">$43,210</span></td>                 </tr>                  <tr>                     <td><span class="bodyGrey">1926</span></td>        <td><span class="bodyGrey">Arnold, Pascal</span></td>   <td><span class="bodyGrey">$24,680</span></td>                 </tr></table></center>                  <center>                 <b>department_table</b></center>                  <center><table border="true" cols="3" width="60%">                     <tr align="CENTER">                         <td><span class="bodyGrey"><b>id</b></span></td>   <td><span class="bodyGrey"><b>name</b></span></td>      <td><span class="bodyGrey"><b>comment</b></span></td>                     </tr>                      <tr>                          <td><span class="bodyGrey">3</span></td>          <td><span class="bodyGrey">Accounting</span></td>       <td><span class="bodyGrey"></span></td>                     </tr>                      <tr>                          <td><span class="bodyGrey">7</span></td>          <td><span class="bodyGrey">Engineering</span></td>      <td><span class="bodyGrey">The very important department. :-)</span></td>                     </tr>                 </table></center>                  <center>                 <b>employee_department</b></center>                  <center><table border="true" cols="2" width="40%">                     <tr align="CENTER">                          <td><span class="bodyGrey"><b>e_id</b></span></td>  <td><span class="bodyGrey"><b>d_id</b></span></td>                     </tr>                      <tr>                          <td><span class="bodyGrey">....</span></td>         <td><span class="bodyGrey">....</span></td>                     </tr>                 </table></center></span></p>          <p><span class="bodyGrey">             Then, the mapping for employee data object would look like this                 <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class name=&quot;com.xyz.Employee&quot; identity=&quot;id&quot;&gt;
        &lt;map-to table=&quot;employee_table&quot;/&gt;
            &lt;field name=&quot;id&quot; type=&quot;integer&quot;&gt;
                &lt;sql name=&quot;id&quot;/&gt;
            &lt;/field&gt;
            &lt;field&gt;
                &lt;sql many-table=&quot;employee_department&quot;
                     many-key=&quot;e_id&quot; name=&quot;d_id&quot;/&gt;
            &lt;/field&gt;
            &lt;field name=&quot;salary&quot;&gt;
                &lt;sql name=&quot;salary&quot; type=&quot;integer&quot;&gt;
            &lt;/field&gt;
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span></td></tr></table></td></tr></table><p></p></span></p>      <a name="Lazy-Loading"><h2>Lazy Loading</h2></a>    <p><span class="bodyGrey">As of release 0.9.6, Castor has full support for lazy loading object instances referenced      as part of all relation types currently supported:</span></p>         <table border="0" cellpadding="2" cellspacing="2"><tr><td colspan="2" height="5"></td></tr><span class="bodyGrey">    <tr><td align="left" valign="top" width="10">-</td><td align="left" valign="top"><span class="bodyGrey">1:1 relations</span></td></tr>    <tr><td align="left" valign="top" width="10">-</td><td align="left" valign="top"><span class="bodyGrey">1:m relations</span></td></tr>    <tr><td align="left" valign="top" width="10">-</td><td align="left" valign="top"><span class="bodyGrey">M:N relations.</span></td></tr>   </span></table>               <a name="1:1-relations"><h3>1:1 relations</h3></a>                   <p><span class="bodyGrey">As of release 0.9.6, Castor supports lazy-loading of 1:1 relations. Imagine the              following class mapping:</span></p>     <span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class name=&quot;com.xzy.Department&quot;&gt;
       ...
       &lt;field &quot;employee&quot; type=&quot;com.xyz.Employee&quot; lazy=&quot;true&quot; /&gt;
       ...
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span>                 <p><span class="bodyGrey">Per definition, when an instance of Department is loaded through e.g. Database.load(),       Castor will not (pre-)load the Employee instance referenced (as such reducing the size       pf the initial query as well as the size of the result set returned). Only when the        Emplyoee instance is accessed through Department.getEmployee(), Castor will load        the actual object into memory from the persistence store.</span></p>           <p><span class="bodyGrey">This means that if the Employee instance is not accessed at all, not only will        the initial query to load the Department object have had its complexity reduced,        but no performance penalty will be incurred for the additional access to the        persistence store either.</span></p>                              <a name="1:M-and-M:N-relations"><h3>1:M and M:N relations</h3></a>                 <p><span class="bodyGrey">The elements in the collection are only loaded when the application asks for                the object from the collection, using, for example, iterator.next(). The                iterator in Castor&rsquo;s lazy collection is optimized to return a loaded object                first.</span></p>               <p><span class="bodyGrey">In the mapping file, lazy loading is specified in the element of the collection&rsquo;s                <tt>&lt;field&gt;</tt>, for example,</span></p>                         <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class name=&quot;com.xzy.Department&quot;&gt;
       ...
        &lt;field name=&quot;employee&quot; type=&quot;com.xyz.Employee&quot; lazy=&quot;true&quot;
               collection=&quot;collection&quot;/&gt;
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span></td></tr></table></td></tr></table><p></p>              <p><span class="bodyGrey">declares that the collection of type Employee in a Department is lazy loaded.</span></p>             <p><span class="bodyGrey">If lazy loading is specified for a field of a class, Castor will set the field with a                special collection which contains only the identities of the objects. Because of                that, it requires the data object to have the method setDepartment( Collection                department) in the data object class which was not required in previous                versions.</span></p>             <p><span class="bodyGrey"><b>Note:</b> Please note that currently <b>only</b> the <tt><b>java.util.Collection</b></tt>                type is supported. </span></p>                                             <a name="Multiple-columns-primary-keys"><h2>Multiple columns primary keys</h2></a>         <p><span class="bodyGrey">             The support of multiple column primary keys (also called compound primary keys) was another major enhancement added into Castor 0.9. Specifying multiple column primary keys is simple and straightforward, in the mapping file,              <p></p><table width="100%" border="0" cellspacing="1" cellpadding="1" bgcolor="#7270c2"><tr><td><table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#dddddd"><tr><td><span class="bodyBlack"><pre>
&lt;mapping&gt;
    &lt;class name=&quot;com.xyz.MyObject&quot; identity=&quot;firstName lastName&quot;&gt;
        &lt;field name=&quot;firstName&quot; type=&quot;string&quot;&gt;
           &lt;sql name=&quot;fname&quot;/&gt;
        &lt;/field&gt;
        &lt;field name=&quot;lastName&quot; type=&quot;string&quot;&gt;
           &lt;sql name=&quot;lname&quot;/&gt;
        &lt;/field&gt;
           ...
    &lt;/class&gt;
&lt;/mapping&gt;</pre></span></td></tr></table></td></tr></table><p></p></span></p>          <p><span class="bodyGrey">Multiple column primary keys work with both master and dependent objects, all             cardinalities of relationship, including one-to-one, one-to-many and many-to-many,             as well as lazy loading. </span></p>          <p><span class="bodyGrey">However, multiple column primary keys should only be used to adhere to an existing             database design, not when designing a new database. In general, it is not a good             idea to use an identity or identities which can be modified by the user, or which             contain application-visible data. For example, if the system allows the user name to             be changed, using user name as identity is highly discouraged, as this practice can require             a major data migration to a new schema to update all foreign keys to adhere to a             new primary key structure, should the user name no longer be adequate as a primary key. It should             be noted that Castor doesn&rsquo;t support identity change, as specified in the ODMG 3.0             specification. So, primary keys changes are almost certainly a large trade off between             data integrity and performance. Well chosen primary keys are usually single (not             multiple) column numeric or character fields for the reasons outlined above, as well as             performance, as joining operations are faster for single column primary keys. </span></p>       </td></tr><tr height="5"><td width="10" height="5" bgcolor="#7270c2" valign="top" align="left">&nbsp;</td><td width="125" height="5" bgcolor="#7270c2" valign="top"><img src="images/dotTrans.gif" width="1" height="15" border="0"><br><img src="images/line_sm.gif" width="105" height="3" border="0" align="right"></td><td width="7" height="5" bgcolor="#a9a5de" valign="top" align="left">&nbsp;</td><td width="70" height="5" valign="top" align="left">&nbsp;</td><td width="120" height="5" valign="top" align="left">&nbsp;</td></tr><tr><td width="10" height="5" bgcolor="#7270c2" valign="top" align="left">&nbsp;</td><td width="125" bgcolor="#7270c2" valign="top" align="left"></td><td width="7" bgcolor="#a9a5de" valign="top" align="left"><img src="images/dotTrans.gif" width="1" height="25" border="0"></td><td width="70" valign="top" align="left"><img src="images/dotTrans.gif" width="1" height="25" border="0"></td><td width="120" valign="top" align="left">&nbsp;</td></tr><tr height="5"><td width="10" rowspan="2" height="100%" bgcolor="#7270c2" valign="bottom" align="left"><img src="images/stripes1.gif" width="10" height="125" border="0"></td><td width="125" rowspan="2" height="100%" bgcolor="#7270c2" valign="bottom" align="left"><img src="images/stripe105.gif" width="105" height="125" border="0"></td><td width="7" rowspan="2" height="100%" bgcolor="#a9a5de" valign="top" align="left">&nbsp;</td><td width="70" height="100%" valign="top" align="left">&nbsp;</td><td width="120" height="100%" valign="top" align="left">&nbsp;</td></tr><tr height="5"><td width="70" height="25" valign="top" align="left">&nbsp;</td><td width="400" height="25" valign="bottom" align="left"><br><br><img src="images/line_light.gif" border="0" width="400" height="3"><br><p></p><span class="bodyGrey"><small><notice>     Copyright &copy; 1999-2005 <a href="http://www.exolab.org">ExoLab Group</a>, Intalio Inc.,     and Contributors.  All rights reserved.   </notice><br>&nbsp;<br></small><small><notice>     Java, EJB, JDBC, JNDI, JTA, Sun, Sun Microsystems are trademarks or registered     trademarks of Sun Microsystems, Inc. in the United States and in other     countries. XML, XML Schema, XSLT and related standards are trademarks or registered     trademarks of MIT, INRIA, Keio or others, and a product of the World Wide Web     Consortium. All other product names mentioned herein are trademarks of their respective     owners.   </notice><br>&nbsp;<br></small></span><p></p>&nbsp;</td><td width="120" height="25" valign="top" align="left">&nbsp;</td></tr></table></body></html>